{% extends "base.html" %}
{% block title %}Tracker{% endblock %}
{% block content %}

<div class="tracker-container">

  <h2 class="tracker-title"> Task Tracker Dashboard</h2>

  <!-- SUMMARY CARDS -->
  <div class="summary-grid">
    <div class="card">
      Today
      <strong>{{ daily_done }}</strong>
    </div>

    <div class="card">
      This Week
      <strong>{{ weekly_done }}</strong>
    </div>

    <div class="card">
      This Month
      <strong>{{ monthly_done }}</strong>
    </div>
  </div>

  <!-- YEARLY BAR CHART -->
  <div class="chart-card">
    <h3>Tasks Completed in {{ year }}</h3>
    <div class="chart-wrapper">
      <div id="yearChart"></div>
    </div>
  </div>

  <!-- COMPLETED TASK HISTORY -->
  <div class="history-card">
    <h3> Completed Tasks History</h3>

    {% if completed_tasks %}
      <ul class="task-list">
        {% for task in completed_tasks %}
        <li class="task-item">
          <span>{{ task.task }}</span>
          <small>
            {{ task.completed_at|date:"d M Y, H:i" }}
          </small>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">No completed tasks yet.</p>
    {% endif %}
  </div>

</div>

<!-- DATA -->
{{ counts|json_script:"counts-data" }}
{{ months|json_script:"months-data" }}

<!-- APEX CHART -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const counts = JSON.parse(
    document.getElementById("counts-data").textContent
  );
  const months = JSON.parse(
    document.getElementById("months-data").textContent
  );

  new ApexCharts(document.querySelector("#yearChart"), {
    chart: {
      type: "bar",
      height: "100%",
      toolbar: { show: false }
    },
    series: [{
      name: "Tasks Completed",
      data: counts
    }],
    xaxis: {
      categories: months
    },
    colors: ["#ff6b35"],
    plotOptions: {
      bar: {
        borderRadius: 8,
        columnWidth: "45%"
      }
    },
    dataLabels: { enabled: true },
    yaxis: { min: 0 },
    responsive: [{
      breakpoint: 768,
      options: {
        plotOptions: {
          bar: { columnWidth: "65%" }
        }
      }
    }]
  }).render();
});
</script>

<style>
/* LAYOUT */
.tracker-container {
  max-width: 1200px;
  margin: 40px auto;
  padding: 20px;
}

.tracker-title {
  text-align: center;
  margin-bottom: 30px;
}

/* SUMMARY */
.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

/* CARDS */
.card {
  background: #fff;
  padding: 20px;
  text-align: center;
  border-radius: 14px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.08);
  font-size: 16px;
}

.card strong {
  font-size: 28px;
  display: block;
  margin-top: 8px;
  color: #ff6b35;
}

/* CHART */
.chart-card {
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}

.chart-wrapper {
  width: 100%;
  height: 380px;
}

@media (max-width: 768px) {
  .chart-wrapper {
    height: 300px;
  }
}

/* HISTORY */
.history-card {
  margin-top: 50px;
}

.task-list {
  list-style: none;
  padding: 0;
}

.task-item {
  background: #fff;
  margin-bottom: 12px;
  padding: 15px 20px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
}

.task-item small {
  color: #666;
}

@media (min-width: 768px) {
  .task-item {
    flex-direction: row;
    justify-content: space-between;
  }
}

.muted {
  color: #777;
}
</style>

{% endblock %}
